{% extends "fornecedor/base.html" %}

{% block title %}Meu Perfil{% endblock %}

{% block conteudo %}
<div class="container d-flex align-items-center justify-content-center flex-grow-1 py-4">
    <div class="col-md-10 col-lg-8">
        <div class="card shadow border-0 auth-card">
            <div class="card-body p-4">
                <div class="text-center mb-4">
                    <h3>Meu Perfil</h3>
                    <small class="text-muted">Gerencie suas informações</small>
                </div>

                <!-- Mensagens de erro/sucesso -->
                {% if erro %}
                <div class="alert alert-danger" role="alert">
                    {{ erro }}
                </div>
                {% endif %}
                {% if sucesso %}
                <div class="alert alert-success" role="alert">
                    {{ sucesso }}
                </div>
                {% endif %}

                <form id="formPerfil" method="post">

                    <!-- Dados Pessoais -->
                    <h5 class="mb-3">Dados Pessoais</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Nome Completo *</label>
                            <input type="text" name="nome" class="form-control" required
                                value="{{ fornecedor.nome if fornecedor else '' }}">
                        </div>
                        <div class="col-md-3 mb-3">
                            <label class="form-label">Data de Nascimento</label>
                            <input type="date" name="data_nascimento" class="form-control"
                                value="{{ fornecedor.data_nascimento if fornecedor else '' }}">
                        </div>
                        <div class="col-md-3 mb-3">
                            <label class="form-label">CPF</label>
                            <input type="text" id="cpf" name="cpf" class="form-control" placeholder="000.000.000-00"
                                value="{{ fornecedor.cpf if fornecedor else '' }}">
                            <div class="invalid-feedback">CPF inválido.</div>
                        </div>
                    </div>

                    <!-- Dados do Negócio -->
                    <h5 class="mb-3">Dados do Negócio</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Nome da Empresa/Negócio</label>
                            <input type="text" name="nome_empresa" class="form-control"
                                placeholder="Nome fantasia ou razão social"
                                value="{{ fornecedor.nome_empresa if fornecedor else '' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">CNPJ</label>
                            <input type="text" id="cnpj" name="cnpj" class="form-control"
                                placeholder="00.000.000/0000-00" value="{{ fornecedor.cnpj if fornecedor else '' }}">
                            <small class="text-muted">Opcional - apenas se possuir</small>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 mb-3">
                            <label class="form-label">Descrição dos Serviços/Produtos/Espaços</label>
                            <textarea name="descricao" class="form-control" rows="3"
                                placeholder="Descreva brevemente o que oferece...">{{ fornecedor.descricao if fornecedor else '' }}</textarea>
                        </div>
                    </div>

                    <!-- Dados de Contato -->
                    <h5 class="mb-3">Dados de Contato</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">E-mail *</label>
                            <input type="email" name="email" class="form-control" required
                                value="{{ fornecedor.email if fornecedor else '' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Telefone *</label>
                            <input type="tel" name="telefone" class="form-control" placeholder="(XX) XXXXX-XXXX"
                                required value="{{ fornecedor.telefone if fornecedor else '' }}">
                        </div>
                    </div>

                    <!-- Preferências -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="newsletter" name="newsletter"
                                    {{ 'checked' if fornecedor and fornecedor.newsletter else '' }}>
                                <label class="form-check-label small" for="newsletter">
                                    Desejo receber novidades e promoções por e-mail
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-end gap-2">
                        <a href="/fornecedor" class="btn btn-info btn-lg">Cancelar</a>
                        <button type="submit" class="btn btn-primary btn-lg">Salvar Alterações</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/scripts.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Validação de tipos de fornecimento
        function validarPerfis() {
            const prestador = document.querySelector('input[name="prestador"]:checked');
            const vendedor = document.querySelector('input[name="vendedor"]:checked');
            const locador = document.querySelector('input[name="locador"]:checked');

            if (!prestador && !vendedor && !locador) {
                alert('Selecione pelo menos um tipo de fornecimento.');
                return false;
            }
            return true;
        }

        // Validação no envio do formulário
        document.getElementById('formPerfil').addEventListener('submit', function (e) {
            if (!validarPerfis()) {
                e.preventDefault();
                return;
            }

            // Remover máscaras antes do envio (usa função do scripts.js)
            removerMascaras();
        });
    });
</script>
{% endblock %}